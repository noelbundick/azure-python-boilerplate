parameters:
  os: linux
  pythonVersions: [3.5, 3.6, 3.7]

jobs:
- job: ${{ format('Build_{0}', parameters.os) }}

  pool:
    ${{ if eq(parameters.os, 'linux') }}:
      vmImage: ubuntu-16.04
    ${{ if eq(parameters.os, 'windows') }}:
      vmImage: windows-2019

  strategy:
    matrix:
      ${{ each version in parameters.pythonVersions }}:
        ${{ version }}:
          python.version: ${{ version }}

  steps:
  - task: UsePythonVersion@0
    displayName: Use Python $(python.version)
    inputs:
      versionSpec: '$(python.version)'

  - script: python -m pip install tox -U
    displayName: Install tox

  - script: tox --notest
    displayName: Provision tox environment

  - script: tox
    displayName: Run tox tests

  - task: PublishCodeCoverageResults@1
    inputs:
      codeCoverageTool: Cobertura
      summaryFileLocation: '$(System.DefaultWorkingDirectory)/**/coverage.xml'
      reportDirectory: '$(System.DefaultWorkingDirectory)/**/htmlcov'
